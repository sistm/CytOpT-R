<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>User guide for executing `CytOpT` on `HIPC` data • CytOpT</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="User guide for executing `CytOpT` on `HIPC` data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CytOpT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CytOpt_HIPC.html">User guide for executing `CytOpT` on `HIPC` data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sistm/CytOpT-R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>User guide for executing `CytOpT` on `HIPC` data</h1>
                        <h4 data-toc-skip class="author">Paul Freulon,
Jérémie Bigot, Kalidou BA, Boris Hejblum</h4>
            
            <h4 data-toc-skip class="date">2025-03-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sistm/CytOpT-R/blob/main/vignettes/CytOpt_HIPC.Rmd" class="external-link"><code>vignettes/CytOpt_HIPC.Rmd</code></a></small>
      <div class="d-none name"><code>CytOpt_HIPC.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html" class="external-link">numeric_version</a></span><span class="op">(</span><span class="fu">py_config</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">version</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '3.11'</span></span>
<span><span class="fu">py_numpy_available</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu">py_module_available</span><span class="op">(</span><span class="st">"scipy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu">py_module_available</span><span class="op">(</span><span class="st">"sklearn"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p><code>CytOpT</code> is a supervised method that directly estimates
the cell proportions in a flow-cytometry data set by using a source
gating as its input and relies on regularized optimal transport.</p>
</div>
<div class="section level2">
<h2 id="analysis-of-hipc-data">Analysis of HIPC data<a class="anchor" aria-label="anchor" href="#analysis-of-hipc-data"></a>
</h2>
<p>As an illustrative example, we analyze here the flow cytometry data
from the T-cell panel of the Human Immunology Project Consortium (HIPC)
publicly available on ImmuneSpace <a href="https://www.nature.com/articles/nbt.2777" class="external-link">Gottardo et
al. [2014]</a>.</p>
<p>An <code>HIPC</code> data set has the following structure (split into
2 files):</p>
<ul>
<li>
<code>xx_y_values</code>: flow-cytometry measurements</li>
<li>
<code>xx_y_clust</code>: file with the corresponding manual
clustering</li>
</ul>
<p>Above, <code>xx</code> denotes the center where the data analysis was
performed, and <code>y</code> denotes the patient and the replicate of
the biological sample in question.</p>
<div class="section level3">
<h3 id="data-load">Data load<a class="anchor" aria-label="anchor" href="#data-load"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sistm.github.io/CytOpT-R/">CytOpT</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"HIPC_Stanford"</span><span class="op">)</span></span></code></pre></div>
<p>Here are the first few lines of the flow-cytometry measurements from
patient <em>1228</em> replicate <em>1A</em>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HIPC_Stanford_1228_1A</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The manual clustering of these data into 10 cell populations (CD8
Effector, CD8 Naive, CD8 Central Memory, CD8 Effector Memory, CD8
Activated, CD4 Effector, CD4 Naive, CD4 Central Memory, CD4 Effector
Memory, CD4 Activated) can be accessed from the
<code>HIPC_Stanford_1228_1A_labels</code> object.</p>
<p>We will use the manual gating from patient <em>1228</em> replicate
<em>1A</em> as our source proportions to infer proportions for patient
<em>1369</em> replicate <em>1A</em>.</p>
</div>
<div class="section level3">
<h3 id="computation-of-the-benchmark-class-proportions-for-target-data">Computation of the benchmark class proportions for target data<a class="anchor" aria-label="anchor" href="#computation-of-the-benchmark-class-proportions-for-target-data"></a>
</h3>
<p>Because in this example, we know the true proportions in the target
data set <code>HIPC_Stanford_1369_1A</code>, we can assess the gap
between the estimate form <code>CytOpt</code> and the cellular
proportions from the reference manual gating. For this purpose, we
compute those manual proportions with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gold_standard_manual_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">HIPC_Stanford_1369_1A_labels</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">HIPC_Stanford_1369_1A_labels</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cytopt">
<code>CytOpT</code><a class="anchor" aria-label="anchor" href="#cytopt"></a>
</h3>
<div class="section level4">
<h4 id="optimization">Optimization<a class="anchor" aria-label="anchor" href="#optimization"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CytOpT.html">CytOpT</a></span><span class="op">(</span>X_s <span class="op">=</span> <span class="va">HIPC_Stanford_1228_1A</span>, X_t <span class="op">=</span> <span class="va">HIPC_Stanford_1369_1A</span>, </span>
<span>              Lab_source <span class="op">=</span> <span class="va">HIPC_Stanford_1228_1A_labels</span>,</span>
<span>              theta_true <span class="op">=</span> <span class="va">gold_standard_manual_prop</span>,</span>
<span>              method<span class="op">=</span><span class="st">'both'</span>, monitoring <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h4>
<p>The results from <code>CytOpt</code> for both optimization algorithms
are:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p>Some visualizations are provided by the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
method:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="performance-evaluation">Performance evaluation<a class="anchor" aria-label="anchor" href="#performance-evaluation"></a>
</h4>
<p>Concordance between the manual gating gold-standard and
<code>CytOpt</code> estimation can be graphically diagnosed with
Bland-Altman plots:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Bland_Altman.html">Bland_Altman</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">proportions</span><span class="op">)</span></span></code></pre></div>
<hr>
<p>The methods implemented in the <code>CytOpt</code> package are
detailed in the following article:</p>
<blockquote>
<p>Paul Freulon, Jérémie Bigot, Boris P. Hejblum. CytOpT: Optimal
Transport with Domain Adaptation for Interpreting Flow Cytometry data
<em>Annals of Applied Statistics</em>, <em>17</em>(2), 1086-1104. <a href="doi:10.1214/22-AOAS1660" class="uri">doi:10.1214/22-AOAS1660</a>
<a href="https://doi.org/10.1214/22-AOAS1660" class="external-link uri">https://doi.org/10.1214/22-AOAS1660</a> <a href="https://arxiv.org/abs/2006.09003" class="external-link uri">https://arxiv.org/abs/2006.09003</a></p>
</blockquote>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Boris Hejblum, Paul Freulon, Kalidou Ba.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
